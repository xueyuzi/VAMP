<!DOCTYPE html>
<html lang="en">

<head>
    <!--[if lt IE 9]>
    <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Serialization demo</title>

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">

    <script src="https://cdn.bootcss.com/lodash.js/4.17.12-pre/lodash.min.js"></script>
    <script src="https://cdn.bootcss.com/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://cdn.bootcss.com/jqueryui/1.12.1/jquery-ui.min.js"></script>
    <!-- <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script> -->
    <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/core-js/2.4.1/shim.min.js"></script> -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/gridstack.js/0.4.0/gridstack.min.css" />
    <script type="text/javascript" src='https://cdnjs.cloudflare.com/ajax/libs/gridstack.js/0.4.0/gridstack.min.js'>
    </script>
    <script type="text/javascript"
        src='https://cdnjs.cloudflare.com/ajax/libs/gridstack.js/0.4.0/gridstack.jQueryUI.min.js'></script>

    <style type="text/css">
        .grid-stack {
            background: lightgoldenrodyellow;
        }

        .grid-stack-item-content {
            color: #2c3e50;
            text-align: center;
            background-color: #18bc9c;
        }
    </style>
</head>

<body>
    <div class="container-fluid">
        <h1>Serialization demo</h1>

        <div>
            <a class="btn btn-default" id="save-grid" href="#">Save Grid</a>
            <a class="btn btn-default" id="load-grid" href="#">Load Grid</a>
            <a class="btn btn-default" id="clear-grid" href="#">Clear Grid</a>
            <a class="btn btn-default" id="add-grid" href="#">add Grid</a>
            <a class="btn btn-default" id="remove-grid" href="#">remove Grid</a>
        </div>

        <br />

        <div class="grid-stack">
        </div>

        <hr />

        <textarea id="saved-data" cols="100" rows="20" readonly="readonly"></textarea>
    </div>


    <script type="text/javascript">
        var template =
            `<div><button id="del-grid" style="z-index:1000;position:relative">del</button><div class="grid-stack-item-content"></div></div>`
        $(function () {
            var options = {
                removable: true,
                removeTimeout: 0
            };
            $('.grid-stack').gridstack(options);
            new function () {
                this.serializedData = [{
                        x: 0,
                        y: 0,
                        width: 2,
                        height: 2
                    },
                    {
                        x: 3,
                        y: 1,
                        width: 1,
                        height: 2
                    },
                    {
                        x: 4,
                        y: 1,
                        width: 1,
                        height: 1
                    },
                    {
                        x: 2,
                        y: 3,
                        width: 3,
                        height: 1
                    },
                    {
                        x: 1,
                        y: 4,
                        width: 1,
                        height: 1
                    },
                    {
                        x: 1,
                        y: 3,
                        width: 1,
                        height: 1
                    },
                    {
                        x: 2,
                        y: 4,
                        width: 1,
                        height: 1
                    },
                    {
                        x: 2,
                        y: 5,
                        width: 1,
                        height: 1
                    }
                ];
                this.grid = $('.grid-stack').data('gridstack');
                this.loadGrid = function () {
                    this.grid.removeAll();
                    var items = GridStackUI.Utils.sort(this.serializedData);
                    items.forEach(function (node) {
                        this.grid.addWidget($(
                                template),
                            node.x, node.y, node.width, node.height);
                    }, this);
                    return false;
                }.bind(this);
                this.saveGrid = function () {
                    this.serializedData = $('.grid-stack > .grid-stack-item:visible').map(function (i, el) {
                        el = $(el);
                        var node = el.data('_gridstack_node');
                        return {
                            x: node.x,
                            y: node.y,
                            width: node.width,
                            height: node.height
                        };
                    }).toArray();
                    $('#saved-data').val(JSON.stringify(this.serializedData, null, '    '));
                    return false;
                }.bind(this);
                this.clearGrid = function () {
                    this.grid.removeAll();
                    return false;
                }.bind(this);

                this.addNewWidget = function () {
                    var node = {
                        x: 12 * Math.random(),
                        y: 5 * Math.random(),
                        width: 1 + 3 * Math.random(),
                        height: 1 + 3 * Math.random()
                    };
                    this.grid.addWidget($(template),
                        node.x, node.y, node.width, node.height);
                    return false;
                }.bind(this);
                this.removeWidget = function (el) {
                    console.log(el)
                    return false;
                }.bind(this);
                $('#save-grid').click(this.saveGrid);
                $('#load-grid').click(this.loadGrid);
                $('#clear-grid').click(this.clearGrid);
                $('#add-grid').click(this.addNewWidget);
                $('#del-grid').click(this.removeWidget);
                this.loadGrid();
            };
        });
    </script>
</body>

</html>